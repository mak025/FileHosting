@page
@model FileOverviewModel
@using System.Linq

@{
    ViewData["Title"] = "Filer";
}

@functions {
    // Returns CSS classes for the thumbnail based on file extension
    public string GetFileTypeClass(string fileName)
    {
        var ext = System.IO.Path.GetExtension(fileName)?.ToLower() ?? "";

        return ext switch
        {
            ".pdf" => "file-thumb pdf",
            ".doc" or ".docx" => "file-thumb doc",
            ".xls" or ".xlsx" => "file-thumb xls",
            ".ppt" or ".pptx" => "file-thumb ppt",
            ".png" or ".jpg" or ".jpeg" or ".gif" => "file-thumb image",
            ".txt" => "file-thumb txt",
            ".url" => "file-thumb url",
            ".zip" or ".rar" => "file-thumb zip",
            _ => "file-thumb generic"
        };
    }
}

<section class="file-overview">

    <!-- Header -->
    <header class="content-header">
        <div class="content-header-left">
            <h1>Alle filer</h1>
            <p class="content-subtitle">Oversigt over alle uploadede filer.</p>
        </div>

        <div class="content-header-right">
            <form method="get" class="search-form">
                <input type="text"
                       name="search"
                       placeholder="Søg i filer..."
                       value="@Request.Query["search"]"
                       class="search-input" />
                <button type="submit" class="btn btn-outline">Søg</button>
            </form>
           
        </div>
    </header>

    <!-- FILE GRID -->
    <section class="file-grid">
        @if (Model.Files != null && Model.Files.Any())
        {
            @foreach (var file in Model.Files)
            {
                <article class="file-card">
                    <div class="file-card-link">
                        <!-- Thumbnail -->
                        <div class="@GetFileTypeClass(file.Name)">
                            <span class="file-icon-label">
                                @System.IO.Path.GetExtension(file.Name).Replace(".", "").ToUpper()
                            </span>
                        </div>

                        <!-- FileName -->
                        <div class="file-title" title="@file.Name">
                            @file.Name
                        </div>
                    </div>

                   
                    <div class="file-meta" style="justify-content: space-between; width: 100%;">
                        <div style="display:flex;align-items:center;gap:8px;">
                            <div class="file-avatar"></div>
                            <div class="file-meta-text">
                                <div class="file-meta-owner">Åbnet af dig</div>
                                <div class="file-meta-date">
                                    @file.UploadedAt.ToString("d. MMM yyyy")
                                </div>
                            </div>
                        </div>

                        <div style="display:flex;align-items:center;gap:8px;">
                            <a asp-page-handler="Download"
                               asp-route-filePath="@file.FilePath"
                               class="btn btn-outline"
                               target="_blank"
                               rel="noopener">
                                Download
                            </a>

                            <form method="post"
                                  asp-page-handler="SoftDelete"
                                  class="inline-form">
                                <input type="hidden" name="filePath" value="@file.FilePath" />
                                <button type="submit"
                                        class="btn-link"
                                        title="Slet (flyt til papirkurv)">
                                    Slet
                                </button>
                            </form>
                        </div>
                    </div>
                </article>
            }
        }
        else
        {
            <p>Ingen filer endnu.</p>
        }
    </section>

    <!-- UPLOAD SECTION -->
    <section class="upload-section">
        <h2>Upload filer</h2>

        <form method="post"
              enctype="multipart/form-data"
              asp-page-handler="Upload"
              class="upload-form">
            <input type="file" name="Upload" class="upload-input" />
            <button type="submit" class="btn btn-primary">Upload</button>
        </form>

        @if (!ViewData.ModelState.IsValid)
        {
            <div class="validation-errors">
                @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                {
                    <p class="validation-error">@error.ErrorMessage</p>
                }
            </div>
        }
    </section>
</section>
